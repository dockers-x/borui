<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Borui - Tunnel Management</title>
    <link rel="stylesheet" href="/css/main.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">
            <svg class="nav-logo" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
                <path d="M511.8 512m-448.2 0a448.2 448.2 0 1 0 896.4 0 448.2 448.2 0 1 0-896.4 0Z" fill="#FEBE49"></path>
                <path d="M333.4 923.6c-28.7-12.5-89.4-42.4-146.8-103.1-25.2-26.6-43.2-52.1-55.4-71.8 6.5-28.3 12.9-56.6 19.4-85 23.7-104 34.6-151.8 54.9-213.1 6.7-20.1 10.1-30.5 15.8-43.4 28.3-64.2 67.8-102 76.1-109.7 13.6-12.7 41.6-36.6 82.1-55.3 9.9-4.6 28.4-12.4 52.6-18.8 22.9-6 41.1-8.2 48.1-8.8 30.4-2.8 60.3-1.5 89.8 4.3 6.1 1.2 17.4 3.6 31.4 7.9 11.4 3.5 36.7 12 64.4 27.8 56 32.1 88.3 75.2 97.7 88.3 20.2 28.4 30.3 52.9 40 76.3 18.5 44.9 25.8 81.1 29.1 97.1 11 53.2 28.5 126.9 57.7 236.8-7.9 12.4-19.9 29.9-36.4 49.3-84.3 99-189 132.4-215.9 140.3-24.8 7.3-70.8 18.4-129.4 17.9-82.2-0.7-144.6-23.7-175.2-37z" fill="#5D3D1E"></path>
                <path d="M568.4 528.5c1.3-4.3 4.3-2.6 6.7-1.6 39.1 16.4 73.5 54.3 72.5 101.3-0.6 26.2-10.9 48.5-28.7 67.4-52.9 56.2-154 58.1-209.4 4-55.5-54.2-37.1-132.8 30-168 2.7-1.4 6.3-4.6 8.4 1.1 2.8 1.5 3.6 3.7 3.4 6.9-2.1 25.1 14.5 41.9 36.6 48.9 21.2 6.7 21.2 6.9 21.2 29.7v28.7c0.1-13.5 0.2-27 0-40.6-0.1-8.5 2.6-13.6 11.7-15.2 8.9-1.6 17.4-4.7 25.1-9.7 15.2-10 22.9-23.7 20.7-42.3-0.6-3.8-1.7-7.6 1.8-10.6z" fill="#9D764F"></path>
                <path d="M212.4 432.6c-39-34.9-52.5-78.4-40-128.5 12.9-51.3 47.1-83.3 98.9-93.9 42.9-8.8 81.6 2 113.7 33-22.7 13.3-46.1 25.4-66.5 42.3-43.4 35.8-75.6 79.7-96.2 132.1-2.2 5.5-2.8 12.4-9.9 15zM635.2 241.2c38.4-39.7 108.7-45 158.2-12.1 70 46.5 76.2 150 12.3 203.5-4.3-1.9-5.5-6-6.9-9.9-27.8-78.3-80.1-135-153.2-173.3-4-2.1-8.4-3.6-10.4-8.2z" fill="#4E3218"></path>
                <path d="M568.4 528.5c8.6 21.5 2.4 42-16.9 55.7-6 4.2-12.5 7.4-19.6 9.6-17.7 5.5-17.7 5.5-17.7 24.5 0 12.2 0.2 24.3-0.1 36.5-0.1 4.7 2.2 12.4-5.4 12.3-6.6-0.1-4.8-7.3-4.9-11.8-0.2-16-0.4-32 0.1-47.9 0.2-7.2-1.7-10.5-9.2-11.6-13.3-2-25.2-7.6-34.8-17.3-12.7-12.9-17.7-27.9-12.1-45.7 19-48.8 98.2-50 120.6-4.3zM407.9 484c-0.1 15-13.2 27.9-28.2 27.7-15-0.1-27.9-13.2-27.7-28.2 0.1-15 13.2-27.9 28.2-27.7 15 0.1 27.8 13.1 27.7 28.2zM666.2 485.5c0.1 15-12.7 28.1-27.7 28.2-15 0.1-28.1-12.7-28.2-27.7-0.1-15 12.7-28.1 27.7-28.2 15-0.1 28.1 12.7 28.2 27.7z" fill="#301D0B"></path>
                <path d="M512.1 703.6c-13.7 0.2-27-2-39.8-6.7-4.5-1.7-9.1-3.8-12.7-6.9-3.7-3.2-11.3-6.8-5.8-13.1 5.3-6.1 7.8 2.1 11.3 4.3 18.9 12.3 39.9 13.4 61.2 11 13.8-1.5 27.6-4.2 37.5-15.6 1.8-2 4.2-2.6 6.4-0.6 2.4 2.1 2.9 4.7 1 7.4-4.1 5.8-9.8 9.8-16.4 12.4-13.7 5.5-28 7.8-42.7 7.8z" fill="#311E0C"></path>
            </svg>
            <span>Borui</span>
        </div>
        <div class="nav-menu">
            <a href="#servers" class="nav-link active" data-i18n="nav.servers">Servers</a>
            <a href="#clients" class="nav-link" data-i18n="nav.clients">Clients</a>
            <a href="#system" class="nav-link" data-i18n="nav.system">System</a>
        </div>
        <div class="nav-actions">
            <div class="lang-menu">
                <button class="lang-menu-button" id="lang-menu-button" aria-label="Select Language">
                    <span class="icon" id="globe-icon"></span>
                    <span id="current-lang-code">EN</span>
                </button>
                <div class="lang-menu-dropdown" id="lang-menu-dropdown">
                    <button class="lang-menu-item" data-lang="en">
                        <span>English</span>
                    </button>
                    <button class="lang-menu-item" data-lang="zh-CN">
                        <span>ÁÆÄ‰Ωì‰∏≠Êñá</span>
                    </button>
                    <button class="lang-menu-item" data-lang="zh-TW">
                        <span>ÁπÅÈ´î‰∏≠Êñá</span>
                    </button>
                </div>
            </div>
            <div class="user-menu">
                <button class="user-menu-button" id="user-menu-button">
                    <span id="user-display-name">Loading...</span>
                    <span class="icon" id="user-menu-icon"></span>
                </button>
                <div class="user-menu-dropdown" id="user-menu-dropdown">
                    <a href="#settings" class="user-menu-item">
                        <span class="icon" id="settings-icon"></span>
                        <span data-i18n="nav.settings">Settings</span>
                    </a>
                    <div class="user-menu-divider"></div>
                    <button class="user-menu-item" onclick="logout()">
                        <span class="icon" id="logout-icon"></span>
                        <span data-i18n="common.logout">Logout</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <main class="container">
        <div id="servers-view" class="view active">
            <div class="view-header">
                <h1 data-i18n="servers.title">Bore Servers</h1>
                <button id="create-server-btn" class="btn-primary">
                    <span class="icon" id="create-server-icon"></span>
                    <span data-i18n="servers.create">Create Server</span>
                </button>
            </div>
            <div id="servers-list" class="items-list">
                <p class="loading" data-i18n="common.loading">Loading...</p>
            </div>
        </div>

        <div id="clients-view" class="view">
            <div class="view-header">
                <h1 data-i18n="clients.title">Bore Clients</h1>
                <button id="create-client-btn" class="btn-primary">
                    <span class="icon" id="create-client-icon"></span>
                    <span data-i18n="clients.create">Create Client</span>
                </button>
            </div>
            <div id="clients-list" class="items-list">
                <p class="loading" data-i18n="common.loading">Loading...</p>
            </div>
        </div>

        <div id="system-view" class="view">
            <div class="view-header">
                <h1 data-i18n="system.title">System Information</h1>
            </div>
            <div id="system-info" class="info-panel">
                <p class="loading" data-i18n="common.loading">Loading...</p>
            </div>
        </div>

        <div id="settings-view" class="view">
            <div class="view-header">
                <h1 data-i18n="settings.title">User Settings</h1>
            </div>
            <div class="settings-panel">
                <div class="settings-section">
                    <h2 data-i18n="settings.account">Account Settings</h2>

                    <div class="settings-card">
                        <h3 data-i18n="settings.changeDisplayName">Change Display Name</h3>
                        <form id="display-name-form" class="settings-form">
                            <div class="form-group">
                                <label for="new-display-name" data-i18n="settings.newDisplayName">New Display Name</label>
                                <input type="text" id="new-display-name" maxlength="50">
                                <small class="form-help" data-i18n="settings.displayNameHelp">Leave empty to use username (max 50 characters)</small>
                            </div>
                            <button type="submit" class="btn-primary" data-i18n="settings.updateDisplayName">Update Display Name</button>
                        </form>
                    </div>

                    <div class="settings-card">
                        <h3 data-i18n="settings.changeUsername">Change Username</h3>
                        <form id="username-form" class="settings-form">
                            <div class="form-group">
                                <label for="new-username" data-i18n="settings.newUsername">New Username</label>
                                <input type="text" id="new-username" required minlength="3">
                                <small class="form-help" data-i18n="settings.usernameHelp">At least 3 characters, used for login</small>
                            </div>
                            <button type="submit" class="btn-primary" data-i18n="settings.updateUsername">Update Username</button>
                        </form>
                    </div>

                    <div class="settings-card">
                        <h3 data-i18n="settings.changePassword">Change Password</h3>
                        <form id="password-form" class="settings-form">
                            <div class="form-group">
                                <label for="current-password" data-i18n="settings.currentPassword">Current Password</label>
                                <input type="password" id="current-password" required>
                            </div>
                            <div class="form-group">
                                <label for="new-password" data-i18n="settings.newPassword">New Password</label>
                                <input type="password" id="new-password" required minlength="6">
                                <small class="form-help" data-i18n="settings.passwordHelp">At least 6 characters</small>
                            </div>
                            <div class="form-group">
                                <label for="confirm-password" data-i18n="settings.confirmPassword">Confirm New Password</label>
                                <input type="password" id="confirm-password" required minlength="6">
                            </div>
                            <button type="submit" class="btn-primary" data-i18n="settings.updatePassword">Update Password</button>
                        </form>
                    </div>

                    <div class="settings-card">
                        <h3 data-i18n="settings.currentUser">Current User</h3>
                        <div class="user-info">
                            <p><strong data-i18n="settings.displayName">Display Name:</strong> <span id="current-display-name">-</span></p>
                            <p><strong data-i18n="settings.username">Username:</strong> <span id="current-username">-</span></p>
                            <p><strong data-i18n="settings.userId">User ID:</strong> <span id="current-user-id">-</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Server Modal -->
    <div id="server-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="server-modal-title" data-i18n="servers.modalTitle">Create Server</h2>
                <span class="close" onclick="closeServerModal()">&times;</span>
            </div>
            <form id="server-form">
                <div class="form-group">
                    <label for="server-name"><span data-i18n="servers.name">Name</span> <span data-i18n="common.required">*</span></label>
                    <input type="text" id="server-name" required>
                </div>
                <div class="form-group">
                    <label for="server-description" data-i18n="servers.description">Description</label>
                    <input type="text" id="server-description">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="server-bind-addr" data-i18n="servers.bindAddr">Bind Address</label>
                        <input type="text" id="server-bind-addr" value="0.0.0.0">
                        <small class="form-help" data-i18n="servers.bindAddrHelp">Control server address for client connections</small>
                    </div>
                    <div class="form-group">
                        <label for="server-bind-tunnels" data-i18n="servers.bindTunnels">Bind Tunnels</label>
                        <input type="text" id="server-bind-tunnels" value="0.0.0.0">
                        <small class="form-help" data-i18n="servers.bindTunnelsHelp">Tunnel data address, defaults to bind address</small>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="server-port-start" data-i18n="servers.portRangeStart">Port Range Start</label>
                        <input type="number" id="server-port-start" value="1024" min="1024" max="65535">
                    </div>
                    <div class="form-group">
                        <label for="server-port-end" data-i18n="servers.portRangeEnd">Port Range End</label>
                        <input type="number" id="server-port-end" value="65535" min="1024" max="65535">
                    </div>
                </div>
                <div class="form-group">
                    <label for="server-secret" data-i18n="servers.secret">Secret (Optional)</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="server-secret" class="password-input">
                        <button type="button" class="password-toggle" onclick="togglePasswordVisibility('server-secret')" aria-label="Toggle password visibility">
                            <span class="password-toggle-icon"></span>
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="server-auto-start">
                        <span data-i18n="servers.autoStart">Auto-start on application boot</span>
                    </label>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeServerModal()" data-i18n="common.cancel">Cancel</button>
                    <button type="submit" class="btn-primary" data-i18n="common.create">Create</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Client Modal -->
    <div id="client-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="client-modal-title" data-i18n="clients.modalTitle">Create Client</h2>
                <span class="close" onclick="closeClientModal()">&times;</span>
            </div>
            <form id="client-form">
                <div class="modal-body">
                    <!-- Tab Navigation -->
                    <div class="modal-tabs">
                        <button type="button" class="modal-tab active" onclick="switchTab(event, 'tab-basic')" data-i18n="clients.tabBasic">Âü∫Á°ÄËÆæÁΩÆ</button>
                        <button type="button" class="modal-tab" onclick="switchTab(event, 'tab-advanced')" data-i18n="clients.tabAdvanced">È´òÁ∫ßÈÖçÁΩÆ</button>
                        <button type="button" class="modal-tab" onclick="switchTab(event, 'tab-webhook')" data-i18n="clients.tabWebhook">Webhook</button>
                    </div>

                    <!-- Tab Panels -->
                    <div class="modal-tab-panels">
                        <!-- Tab 1: Basic Settings -->
                        <div id="tab-basic" class="modal-tab-panel active">
                            <div class="form-section">
                                <div class="form-group">
                                    <label for="client-name"><span data-i18n="clients.name">Name</span> <span data-i18n="common.required">*</span></label>
                                    <input type="text" id="client-name" required>
                                </div>
                                <div class="form-group">
                                    <label for="client-description" data-i18n="clients.description">Description</label>
                                    <input type="text" id="client-description">
                                </div>
                            </div>

                            <div class="form-section">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="client-local-host" data-i18n="clients.localHost">Local Host</label>
                                        <input type="text" id="client-local-host" value="localhost">
                                    </div>
                                    <div class="form-group">
                                        <label for="client-local-port"><span data-i18n="clients.localPort">Local Port</span> <span data-i18n="common.required">*</span></label>
                                        <input type="number" id="client-local-port" required min="1" max="65535">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="client-remote-server"><span data-i18n="clients.remoteServer">Remote Server</span> <span data-i18n="common.required">*</span></label>
                                        <input type="text" id="client-remote-server" required placeholder="example.com">
                                    </div>
                                    <div class="form-group">
                                        <label for="client-remote-port" data-i18n="clients.remotePort">Remote Port</label>
                                        <input type="number" id="client-remote-port" value="0" min="0" max="65535">
                                        <small class="form-help" data-i18n="clients.remotePortHelp">0 = auto-assign</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 2: Advanced Configuration -->
                        <div id="tab-advanced" class="modal-tab-panel">
                            <div class="form-section">
                                <div class="form-group">
                                    <label for="client-secret" data-i18n="clients.secret">Secret (Optional)</label>
                                    <div class="password-input-wrapper">
                                        <input type="password" id="client-secret" class="password-input">
                                        <button type="button" class="password-toggle" onclick="togglePasswordVisibility('client-secret')" aria-label="Toggle password visibility">
                                            <span class="password-toggle-icon"></span>
                                        </button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="client-auto-start">
                                        <span data-i18n="clients.autoStart">Auto-start on application boot</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 3: Webhook Configuration -->
                        <div id="tab-webhook" class="modal-tab-panel">
                            <div class="webhook-section" id="webhook-section">
                                <div class="webhook-header">
                                    <div class="webhook-title-group">
                                        <h3>
                                            <span data-i18n="clients.webhook">Webhook</span>
                                            <span class="webhook-status-indicator status-disabled" id="webhook-status-badge">
                                                <span data-i18n="clients.webhookDisabled">Off</span>
                                            </span>
                                        </h3>
                                    </div>
                                    <div class="webhook-toggle-wrapper">
                                        <label class="webhook-toggle">
                                            <input type="checkbox" id="webhook-enabled" onchange="toggleWebhookSection()">
                                            <span class="webhook-toggle-slider"></span>
                                        </label>
                                        <button type="button" class="btn-link" onclick="showWebhookHelp()">
                                            <span data-i18n="clients.webhookHelp">üìñ Guide</span>
                                        </button>
                                    </div>
                                </div>

                                <div class="webhook-config" id="webhook-config">
                                    <div class="form-group">
                                        <label for="client-webhook-url" data-i18n="clients.webhookUrl">Webhook URL</label>
                                        <input type="url" id="client-webhook-url" data-i18n-placeholder="clients.webhookUrlPlaceholder" placeholder="https://your-webhook.example.com/hook">
                                        <span class="form-help" data-i18n="clients.webhookUrlHelp">Endpoint URL for notifications</span>
                                    </div>

                                    <div class="form-group">
                                        <label for="client-webhook-format" data-i18n="clients.webhookFormat">Format</label>
                                        <select id="client-webhook-format" onchange="toggleWebhookTemplate()">
                                            <option value="json" data-i18n="clients.webhookFormatJson">Standard JSON</option>
                                            <option value="custom" data-i18n="clients.webhookFormatCustom">Custom Template</option>
                                        </select>
                                        <div class="webhook-format-indicator" id="webhook-format-info">
                                            <span data-i18n="clients.webhookFormatInfo">Structured JSON for integrations</span>
                                        </div>
                                    </div>

                                    <div class="form-group hidden" id="webhook-template-group">
                                        <div class="webhook-preset-group">
                                            <div class="form-group">
                                                <label for="webhook-template-preset" data-i18n="clients.webhookPreset">Presets</label>
                                                <select id="webhook-template-preset" onchange="applyWebhookPreset()">
                                                    <option value="" data-i18n="clients.webhookPresetCustom">Custom...</option>
                                                    <option value="slack" data-i18n="clients.webhookPresetSlack">Slack</option>
                                                    <option value="discord" data-i18n="clients.webhookPresetDiscord">Discord</option>
                                                    <option value="simple" data-i18n="clients.webhookPresetSimple">Simple Text</option>
                                                </select>
                                            </div>
                                        </div>
                                        <label for="client-webhook-template" data-i18n="clients.webhookTemplate">Template (Handlebars)</label>
                                        <textarea id="client-webhook-template" rows="5" data-i18n-placeholder="clients.webhookTemplatePlaceholder" placeholder="Client {{client_name}} {{event}} at {{timestamp}}"></textarea>
                                        <span class="form-help" data-i18n="clients.webhookTemplateHelp">Use Handlebars syntax</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeClientModal()" data-i18n="common.cancel">Cancel</button>
                    <button type="submit" class="btn-primary" data-i18n="common.create">Create</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Webhook Help Modal -->
    <div id="webhook-help-modal" class="modal webhook-help-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-i18n="webhookHelp.title">Webhook Integration Guide</h2>
                <span class="close" onclick="closeWebhookHelp()">&times;</span>
            </div>
            <div class="webhook-help-content">
                <p data-i18n="webhookHelp.intro">Webhooks allow automatic notifications when client status changes.</p>

                <h3 data-i18n="webhookHelp.events">Webhook Events</h3>
                <ul>
                    <li><code>client.connected</code> <span data-i18n="webhookHelp.eventConnectedDesc">- Triggered when client successfully connects</span></li>
                    <li><code>client.disconnected</code> <span data-i18n="webhookHelp.eventDisconnectedDesc">- Triggered when client disconnects/stops</span></li>
                </ul>

                <h3 data-i18n="webhookHelp.formats">Webhook Formats</h3>
                <h4 data-i18n="webhookHelp.formatJson">Standard JSON Format</h4>
                <p data-i18n="webhookHelp.formatJsonDesc">Sends structured JSON payload with predefined fields.</p>
                <pre><code>{
  "event": "client.connected",
  "timestamp": "2025-01-10T12:00:00Z",
  "client_id": 1,
  "client_name": "my-client",
  "local_host": "localhost",
  "local_port": 8080,
  "remote_server": "example.com:7835",
  "assigned_port": 12345,
  "description": "My test client"
}</code></pre>

                <h4 data-i18n="webhookHelp.formatCustom">Custom Template Format</h4>
                <p data-i18n="webhookHelp.formatCustomDesc">Use Handlebars templates to customize the payload format.</p>
                <pre><code>Client {{client_name}} (ID: {{client_id}}) {{event}} at {{timestamp}}
{{#if assigned_port}}Assigned Port: {{assigned_port}}{{/if}}</code></pre>

                <h3 data-i18n="webhookHelp.variables">Available Template Variables</h3>
                <ul>
                    <li><strong data-i18n="webhookHelp.variablesCommonTitle">Common (all events):</strong> <code>{{event}}</code>, <code>{{timestamp}}</code>, <code>{{client_id}}</code>, <code>{{client_name}}</code>, <code>{{description}}</code></li>
                    <li><strong data-i18n="webhookHelp.variablesConnectedTitle">Connected event:</strong> <code>{{local_host}}</code>, <code>{{local_port}}</code>, <code>{{remote_server}}</code>, <code>{{assigned_port}}</code></li>
                    <li><strong data-i18n="webhookHelp.variablesDisconnectedTitle">Disconnected event:</strong> <code>{{uptime_seconds}}</code></li>
                </ul>

                <h3 data-i18n="webhookHelp.testing">Testing Webhooks</h3>
                <p data-i18n="webhookHelp.testingDesc">Use <code>webhook.site</code> or <code>requestbin.com</code> to get a temporary URL for testing.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-primary" onclick="closeWebhookHelp()" data-i18n="webhookHelp.close">Close</button>
            </div>
        </div>
    </div>

    <div id="status-bar" class="status-bar">
        <span id="connection-status">
            <span class="status-indicator connected"></span>
            <span data-i18n="status.connected">Connected</span>
        </span>
    </div>

    <script src="/js/i18n.js"></script>
    <script src="/js/icons.js"></script>
    <script src="/js/toast.js"></script>
    <script src="/js/api.js"></script>
    <script src="/js/websocket.js"></script>
    <script src="/js/servers.js"></script>
    <script src="/js/clients.js"></script>
    <script src="/js/settings.js"></script>
    <script src="/js/app.js"></script>
</body>
</html>
